import{ci as L,cg as $,ch as R,i as w,$ as A,aN as B,cj as T,ck as f,a as s,aD as U,cm as q,K as F,J as K,eZ as N,hP as j,bU as Z,bV as J,Z as W,b$ as X,b1 as I,c4 as G,a1 as H,qf as Q,qg as V,hQ as v,c8 as O,eg as Y,qh as ee,cD as ne,bI as te,gk as oe,cH as ae,cF as se,qi as re,D as ie}from"./app.DCvXxO1S.js";function ce(){const e=L(),n=$(),t=R(),a=w(),i=A(),l=a("review.blocks.change_link_label","Change"),{inMemoryAmazonPayParts:{hasPaymentSheetError:d}}=B();return!T()||n.status!==f.Available?null:s(U,{onPress:()=>{try{n.sdk.buywithprime.changePaymentMethod({amazonPayOptions:{amazonCheckoutSessionId:t(),isDeclined:e}})}catch(c){d.value=!0,i.notify(new q(`Error on changing buyer payment method. Details: ${c}`,{cause:c}))}},children:l})}class r extends Error{name="PortableWalletsSandboxError"}const ue="oZdJX",le={PortableWalletsPCIButton:ue};function de({wallet:e,isSdkOnly:n=!1}){const{id:t}=F(),a=A(),i=K(),{value:l}=N(),{countryCode:d,presentmentCurrency:h}=l??{},c=j(e)?.configurationParams,p=Z(null),{isScrimOpen:m,closePopupWindowsAndScrim:x}=J({endpoint:p}),{inMemoryAmazonPayParts:{buttonStatus:g,sdkStatus:y}}=B(),M=w(),b=W(null),S=W(null),C=X(),P=I(({errorMessage:o})=>a.notify(new r(o)),[a]),D=I(async o=>{y.value={status:f.Loading},p.value=o;const u=await o.call.configure({configurationParams:c,buyerCountry:d,buyerCurrency:h,shopId:t,cartId:i.sourceId,onlySdk:n});u?.status==="success"?(y.value=he(e,o),n||(g.value={status:"rendered"})):u?.status==="error"&&(P({errorMessage:u?.message}),y.value={status:f.Error},n||(g.value={status:"error"}))},[c,d,t,h,i.sourceId,n,e,P,y,g,p]),k=G(),E=H(()=>({clicked:o=>{m.value=!0,C(S),o&&me(o.skus,o.apiClientId)},closed:()=>m.value=!1,redirect:({redirectUrl:o,requestPayload:u})=>{try{if(u){if(!b.current){a.notify(new Q("Form container not found"));return}V({formContainer:b.current,url:o,requestPayload:u}).submit()}else window.location.assign(o)}catch(_){a.notify(_)}},reportError:P,telemetry:k}),[m,P,a,C,k]);return c?!d||!h?(a.notify(new v(`[PortableWalletsButton] Attempted to render wallet button for ${e}, but no countryCode or presentmentCurrency was found.`)),null):s("div",{className:le.PortableWalletsPCIButton,children:[s("div",{ref:b,style:{display:"none"}}),s(O,{wallet:e,onConnect:D,hostMethods:E,isSdkOnly:n,ref:S}),s(Y,{isOpen:m.value,walletName:M("brand.buy_with_prime","Buy with Prime"),handleClose:x})]}):(a.notify(new v(`[PortableWalletsButton] Attempted to render wallet button for ${e}, but no config was found.`)),null)}function he(e,n){return{status:f.Available,sdk:{buywithprime:{changePaymentMethod:({amazonPayOptions:t})=>{if(!t.amazonCheckoutSessionId)throw new r("Missing amazonCheckoutSessionId");n.call.changePaymentMethod({wallet:e,changePaymentParams:{amazonCheckoutSessionId:t.amazonCheckoutSessionId,isDeclined:t.isDeclined}})},changeShippingAddress:({amazonPayOptions:t})=>{if(!t.amazonCheckoutSessionId)throw new r("Missing amazonCheckoutSessionId");n.call.changeShippingAddress({wallet:e,changeShippingParams:{amazonCheckoutSessionId:t.amazonCheckoutSessionId}})},initCheckout:()=>{throw new r('Unexpected invocation of "initCheckout"')},renderButton:()=>{throw new r('Unexpected invocation of "renderButton"')}},Pay:{changePaymentMethod:()=>{throw new r('Unexpected invocation of AmazonPay "changePaymentMethod" in BWP flow')},changeShippingAddress:()=>{throw new r('Unexpected invocation of AmazonPay "changeShippingAddress" in BWP flow')},initCheckout:()=>{throw new r('Unexpected invocation of AmazonPay "initCheckout" in BWP flow')},renderButton:()=>{throw new r('Unexpected invocation of AmazonPay "renderButton" in BWP flow')}}}}}function me(e,n){window.Shopify?.analytics?.publish&&(window.Shopify.analytics.publish(`shopify:app:pixels:load:${n}`,{},{sendTo:"PIXEL-LOADER"}),window.Shopify.analytics.publish("bwp_checkout_widget_click",{skus:e},{sendTo:n}))}function ye(){const e=w(),{brand:n,descriptor:t}=ee(),a=ne(),i=te(),l=!t||!a;return s(ie,{children:[i?s(de,{wallet:oe.BuyWithPrime,isSdkOnly:!0}):null,s(ae,{id:"buyWithPrimePayDetails",label:e("payment.payment_method","Payment method"),summary:l?s(se,{}):s(re,{brand:n,descriptor:t}),action:s(ce,{})})]})}const fe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{de as P,fe as V};
