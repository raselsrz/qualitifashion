import{a0 as he,gB as ne,gC as ke,dv as fe,gD as ye,gE as me,aw as ie,K as ge,J as Ce,dq as be,U as Se,$ as Ae,gF as Pe,ad as Ie,gG as Ee,be as _e,E as se,dG as we,gH as ve,a1 as R,gI as Oe,b1 as u,gJ as Le,gK as W,gL as Ne,gM as xe,gN as I,gO as De}from"./app.DCvXxO1S.js";const ae="checkout";class ce extends Error{name="TrekkieError"}class We{libraryLoaded=!1;analyticsWindow;trekkieLoadedCallback;get trekkie(){return this.analyticsWindow?.trekkie}set trekkie(t){if(!this.analyticsWindow)throw new ce("AnalyticsWindow is not set.");this.analyticsWindow.trekkie=t}get shopifyAnalytics(){return this.analyticsWindow.ShopifyAnalytics}set shopifyAnalytics(t){if(!this.analyticsWindow)throw new ce("AnalyticsWindow is not set.");this.analyticsWindow.ShopifyAnalytics=t}constructor({shop:t,checkoutToken:p="",locale:r,analyticsConfig:C,sourceUrl:m,themeId:k,themeCityHash:g,monorail:h,s2s:c,monorailRegion:v},x){if(this.trekkieLoadedCallback=x,this.analyticsWindow=window,this.trekkie=this.analyticsWindow.ShopifyAnalytics?.lib||this.analyticsWindow.trekkie||[],this.trekkie?.integrations){this.libraryLoaded=!0,this.trekkieLoadedCallback(this.analyticsWindow?.ShopifyAnalytics?.lib?.trekkie);return}const O=parseInt(he(t.id),10),f=new Set([ye,me,ne]),E=t.enabledBetas.filter(_=>f.has(_));this.trekkie.ready(()=>{this.libraryLoaded||(this.libraryLoaded=!0,this.shopifyAnalytics={...this.shopifyAnalytics,lib:this.trekkie},this.trekkieLoadedCallback(this.analyticsWindow?.ShopifyAnalytics?.lib?.trekkie))}),this.trekkie.load=_=>{this.trekkie.config=_;const{assetPath:D,sriHash:b}=t.trekkieLoadConfiguration,A=D&&b&&E.includes(ne),P=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript",a.onerror=function(){const y=document.createElement("script");y.type="text/javascript",y.onerror=function(){const i={schemaId:"trekkie_checkout_load_errors/1.1",payload:{appName:ae,shopId:O,themeId:k,contextUrl:window.location.href,sourceUrl:m}};h.record(i)},y.async=!0,y.src=m,A&&(y.setAttribute("integrity",b),y.setAttribute("crossorigin","anonymous")),P.parentNode?.insertBefore(y,P)},a.async=!0,a.src=m,A&&(a.setAttribute("integrity",b),a.setAttribute("crossorigin","anonymous")),P.parentNode?.insertBefore(a,P)};const L={appName:ae,development:ke()||!1,defaultAttributes:{shopId:O,isMerchantRequest:fe("_ab")?!0:null,themeId:k,themeCityHash:g,contentLanguage:r,currency:t.currencyCode,checkoutToken:p},isServerSideCookieWritingEnabled:!0,enabledBetaFlags:E};v&&(L.monorailRegion=v),this.trekkie.load({Trekkie:L,...C,"Session Attribution":{},S2S:c})}page(t="",p={},r){this.trekkie?.page(t,p,r)}track(t,p,r,C,m){this.trekkie?.track(t,p,r,C,m)}}function Te(s,t){return new We(s,t)}var l=(s=>(s.StartedOrder="Started Order",s.StartedOrderOncePerCheckout="Started Order Once Per Checkout",s.CompletedOrder="Completed Order",s.AddedPayment="Added Payment",s.CheckoutContactPageStarted="Checkout Contact Step Started",s.CheckoutContactInfoSubmitted="Checkout Contact Info Submitted",s.CheckoutAddressInfoSubmitted="Checkout Address Info Submitted",s.CheckoutShippingPageStarted="Checkout Shipping Step Started",s.CheckoutShippingInfoSubmitted="Checkout Shipping Info Submitted",s.CheckoutPaymentPageStarted="Checkout Payment Step Started",s.CheckoutOnePageView="Checkout One Page View",s))(l||{});function N(s){switch(s){case"/":case"/information":return{title:"Checkout - Contact Information",page:"/checkout/contact_information"};case"/shipping":return{title:"Checkout - Shipping",page:"/checkout/shipping"};case"/payment":return{title:"Checkout - Payment",page:"/checkout/payment"};case"/review":return{title:"Checkout - Review",page:"/checkout/review"};case"/processing":return{title:"Checkout - Processing",page:"/checkout/processing"};case"/thank-you":return{title:"Checkout - Receipt",page:"/checkout/thank_you"};case"/stock-problems":return{title:"Checkout - Stock problems",page:"/checkout/stock_problems"};case"/error":return{title:"Checkout - Error",page:"/checkout/error"};case"/no-address-location":return{title:"Checkout - No Address Location",page:"/checkout/no_address_location"};case"/shoppay_login":return{title:"ShopPay - Login",page:"/shop.app/pay/login"};case"/shoppay":return{title:"ShopPay - Payment",page:"/shop.app/pay/payment"};default:return{title:null,page:null}}}function B(s){return s.current.fields.merchandiseLines.peek()?.lines?.map(r=>{const C=r.lineAllocations.reduce((k,g)=>(g.allocations.filter(h=>h.discountDetails.discount.type==="code").forEach(h=>{h.amount.amount>k.amount&&(k.amount=h.amount.amount,k.code=h.discountDetails.title)}),k),{code:void 0,amount:0});return{variantId:W(r.variantId),productId:W(r.productId),productGid:r.productId,category:r.productType,coupon:C.code,currency:r.itemPrice?.currencyCode,name:r.title,price:r.itemPrice?.amount,quantity:r.quantity,brand:r.vendor,variant:r.subtitle,sku:r.sku}})}function Fe(s){let t;t=De;const p=s?.assetPath||"s/trekkie.storefront.min.js";return`https://${t}/${p}`}function Re(){const s=ie()?"trekkie-checkout-one-shop-app":"trekkie-checkout-one",t=ge(),p=Ce(),r=p.checkoutSessionIdentifier||p.sourceId,C=be(),m=Se(),k=Ae();let g=t.theme?.id===void 0||t.theme?.id===null?void 0:parseInt(t.theme.id,10);g&&g>Number.MAX_SAFE_INTEGER&&(g=void 0);const h=t.theme?.cityhash,c=Pe(),{email:v,phone:x,shippingAddress:O}=Ie(),f=Ee(),{value:E}=_e(),L=se("api-client-id"),_=se("api-client-id"),{currentPage:D}=we(),b=D&&["onePage"].includes(D.id),A=ve(),P=R(()=>{if(ie()||A)return{};const e=t.analyticsAccount?{"Google Analytics":{trackingId:t.analyticsAccount,domain:"auto",siteSpeedSampleRate:"10",enhancedEcommerce:t.enhancedEcommerceEnabled,doubleClick:!0,includeSearch:!0}}:{};return(t.trackingPixels||[]).reduce((o,{pixelType:n,pixelId:S})=>{switch(n){case"FACEBOOK":o["Facebook Pixel"]||(o["Facebook Pixel"]={pixelIds:[],agent:"plshopify1.2"}),o["Facebook Pixel"].pixelIds.push(S);break}return o},e)},[t.trackingPixels,t.analyticsAccount,t.enhancedEcommerceEnabled,A]),a=Oe(),y=u(e=>{if(e==null||a.value.defaultAttributes===e.defaultAttributes){e==null&&k.notify(new Le("Trekkie is not available"));return}a.setValue({defaultAttributes:e.defaultAttributes})},[k,a]),i=R(()=>{const e=h===null?void 0:h,o=c.current.fields.buyerIdentity.peek(),n={facebookAppPixelId:t.facebookAppPixelId,facebookCapiEnabled:t.facebookCapiEnabled,source:s,customerId:W(o?.customerProfile?.id),cartApiClientId:L,apiClientId:_},S={shop:t,checkoutToken:r,locale:m,analyticsConfig:P,sourceUrl:Fe(t.trekkieLoadConfiguration),themeId:g,themeCityHash:e,monorail:C,monorailRegion:"shop_domain",s2s:n};return A?null:Te(S,y)},[t,r,m,P,g,h,C,y,c,L,_,s,A]),G=u(e=>{const{title:o,page:n}=N(e);!o||!n||i?.page(o,{path:n})},[i]),H=u(e=>{const{title:o,page:n}=N(e);if(!o||!n)return;const S={name:o,path:n};i?.track(l.CheckoutOnePageView,S,void 0,void 0,{shopifyEmitted:!0})},[i]),V=R(()=>{let e={amount:void 0,currencyCode:void 0};return f&&E?.status==="filled"&&E.lines.forEach(o=>{if(o.status==="available"){const n=o.selectedDeliveryMethodHandle;n&&(e=o.methods.filter(d=>d.handle===n&&d.costAfterDiscounts!==void 0).reduce((d,F)=>{const w=d.amount===void 0?0:d.amount;return d.amount=w+F.costAfterDiscounts.amount,d.currencyCode=F.costAfterDiscounts.currencyCode,d},e))}}),e},[E,f]),z=u(()=>{const e=c.current.fields.subtotal.peek(),n={step:1,products:B(c),currency:e?.currencyCode,revenue:e?.amount};i?.track(l.StartedOrder,n,void 0,void 0,{shopifyEmitted:!0})},[i,c]),q=u(()=>{const e=c.current.fields.subtotal.peek(),n={step:1,products:B(c),currency:e?.currencyCode,revenue:e?.amount};i?.track(l.StartedOrderOncePerCheckout,n,void 0,void 0,{shopifyEmitted:!0})},[i,c]),$=Ne(),J=u(()=>{if(!f||$)return;const e=B(c),o=f.purchaseOrder,n=W(f.orderIdentity.id),S=n?.toString(),d=o.billingAddress,w=c.current.fields.buyerIdentity.peek()?.customerProfile;let ee=w?.firstName,K=w?.lastName;K||(ee=d?.firstName,K=d?.lastName);const te=c.current.fields.total.peek(),re=c.current.fields.subtotal.peek(),ue=xe(c),oe=c.current.fields.contactInfo.peek(),de=c.current.fields.discountLines.peek()?.lines.filter(M=>M.discount.type==="code").map(M=>M.discount.title)||[],le=f.analytics?.checkoutCompletedEventId||void 0,pe=f.analytics?.emitConversionEvent||!1;i?.track(l.CompletedOrder,{customerEventData:{pixelID:t.facebookAppPixelId??void 0,customer:{firstName:ee,lastName:K,emailAddress:w?.email??oe?.email,phoneNumber:w?.phone??oe?.phone},address:{city:d?.city,province:d?.zoneCode,country:d?.countryCode,zip:d?.postalCode}},orderId:n,orderName:S,products:e,total:te?.amount??0,currency:te?.currencyCode,revenue:re?.amount??0,coupon:de[0],tax:ue?.amount??0,shipping:V.amount??0},le,pe,{shopifyEmitted:!0})},[f,$,c,i,t.facebookAppPixelId,V.amount]),X=u(()=>{const e=c.current.fields.runningTotal.peek(),o={currency:e?.currencyCode,total:e?.amount};i?.track(l.AddedPayment,o,void 0,void 0,{shopifyEmitted:!0})},[i,c]),U=u(()=>{const{title:e,page:o}=N("/information"),n={name:e,path:o};i?.track(l.CheckoutContactPageStarted,n,void 0,void 0,{shopifyEmitted:!0})},[i]),Y=u(()=>{const e=v.peek(),o=x.peek(),n={email:e,phone:o};i?.track(l.CheckoutContactInfoSubmitted,n,void 0,void 0,{shopifyEmitted:!0})},[i,v,x]),Q=u(()=>{const e=O.peek(),o={city:e?.city,country:e?.countryCode,phone:e?.phone,province:e?.zoneCode,postalCode:e?.postalCode,firstName:e?.firstName,lastName:e?.lastName,address1:e?.address1,address2:e?.address2};i?.track(l.CheckoutAddressInfoSubmitted,o,void 0,void 0,{shopifyEmitted:!0})},[i,O]),Z=u(()=>{const{title:e,page:o}=N("/shipping"),n={name:e,path:o};i?.track(l.CheckoutShippingPageStarted,n,void 0,void 0,{shopifyEmitted:!0})},[i]),T=u(()=>{const e=c.current.fields.runningTotal.peek(),o={total:e?.amount,currency:e?.currencyCode};i?.track(l.CheckoutShippingInfoSubmitted,o,void 0,void 0,{shopifyEmitted:!0})},[i,c]),j=u(()=>{const{title:e,page:o}=N("/payment"),n={name:e,path:o};i?.track(l.CheckoutPaymentPageStarted,n,void 0,void 0,{shopifyEmitted:!0})},[i]);return I(u(e=>{a.value.defaultAttributes&&e.type==="page_view"&&G(e.url)},[a,G])),I(u(e=>{a.value.defaultAttributes&&e.type==="initiate_checkout"&&z()},[a,z])),I(u(e=>{a.value.defaultAttributes&&e.type==="initiate_checkout_once_per_checkout"&&q()},[a,q])),I(u(e=>{a.value.defaultAttributes&&e.type==="complete_checkout"&&J()},[a,J])),I(u(e=>{a.value.defaultAttributes&&e.type==="add_payment_info"&&X()},[a,X])),I(u(e=>{a.value.defaultAttributes&&e.type==="one_page_checkout_page_view"&&H(e.url)},[a,H])),I(u(e=>{a.value.defaultAttributes&&(e.type==="section_interaction"&&b&&(e.section==="contact"?U():e.section==="payment"&&(T(),j())),e.type==="section_complete"&&(e.section==="contact"?Y():e.section==="deliveryAddress"&&Q()),e.type==="shipping_methods_filled"&&b&&Z(),e.type==="page_submit"&&e.page==="shipping"&&!b&&T())},[a.value.defaultAttributes,b,U,T,j,Y,Q,Z])),null}export{Re as default};
