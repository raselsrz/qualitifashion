import{eV as le,i as R,a as e,ep as H,dp as Z,eW as G,ae as E,Z as U,b1 as g,bU as j,ad as te,eX as W,cr as ce,eY as de,a1 as ue,ct as J,ah as K,cu as ae,ag as me,al as V,af as S,z as B,cw as pe,eZ as he,e_ as fe,cW as _e,e$ as be,f0 as ge,f1 as ye,bS as Pe,D as oe,f2 as ve,eG as Ie,f3 as Ee,b8 as Q,y as Se,x as Ce,d as Me,f4 as Re,B as L,ar as ee,ak as Fe,f5 as Oe,ab as Ne,e as ke,f6 as xe,b3 as Ae}from"./app.DCvXxO1S.js";import{u as Te}from"./ShopPayOptInDisclaimer.Cv2rT4II.js";function Ge(){const{value:n}=le();return!!n}function Le({defaultEmail:n}){const{record:o}=Z(),{autoOptIn:a,isOptedIn:s}=G(),[r,t]=E(n),i=U(void 0),c=g(()=>{r!==i.current&&(i.current=r,o({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:"update_email_input",email:r,source:"order_created",trigger:a&&s?"auto":"manual"}}))},[a,s,r,o]);return{value:r,handleInput:m=>{t(m)},handleBlur:()=>{c()}}}function Be({value:n,onInput:o,onBlur:a}){const s=R(),{value:r,handleInput:t,handleBlur:i}=Le({defaultEmail:n});return e(H,{type:"email",id:"email",name:"email",label:s("shop_pay_remember_me.email_label","Email"),value:r,onInput:c=>{t(c),o?.(c)},onBlur:()=>{i(),a?.()},required:!1})}function Ve(){const n=j(void 0),o=j(void 0),a=R(),s=te(),[,r]=W(),t=ce(),i=s.shippingAddress.fields.firstName.value,c=de("shipping"),p=!ue(()=>c??t,[c,t]).isRequired("firstName")&&!J(i),h=g(l=>{if(!J(l))return a("field_errors.address_first_name_blank","Enter a first name")},[a]),b=g(l=>{if(!p)return;if(!J(l))return o.value=K.InvalidOptInName,a("field_errors.address_first_name_blank","Enter a first name");const C=n.peek()||"";r({optInFirstName:C})},[p,n,r,a,o]),F=ae(n,o,h);return me(n,o,b,K.InvalidOptInName),p?e(V,{children:e(H,{name:"shopFirstName",label:a("contact.first_name_label","First name"),required:!0,...F})}):null}function ze({countryCode:n,validationError:o,value:a,onBlur:s=()=>{},onInput:r=()=>{}}){const t=R(),{record:i}=Z(),c=U(""),m=g(p=>{i({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:"update_phone_input",phoneNumber:c.current,source:"order_created",trigger:p}})},[i]);return S(()=>{c.current!==a&&(c.current=a,m("auto"))},[m,a]),e(pe,{error:o?e(B,{children:t("general.errors.buyer_identity.phone_number_does_not_match_expected_pattern","The specified phone number does not match the expected pattern.")}):void 0,countryCode:n,label:t("shop_pay_remember_me.mobile_phone_number","Mobile phone number"),value:a,icon:"mobile",prefillCountryCode:!!n,onInputValueChange:p=>{r?.(p,n),c.current=p},onBlur:()=>{m("manual"),s?.()},onSelectedCountryChange:(p,h)=>{r?.(h,p),c.current=h}})}const A="RememberMeCheckbox";function ne(){const{record:n}=Z(),o=te(),{value:a}=he(),{autoOptIn:s,isOptedIn:r}=G(),[t,i]=W(),c=t||s&&t===void 0,m=o.phone.value,p=o.email.value,h=!m,{shopPayOptInPhone:b}=a||{},F=fe(),[l,O]=E(F),C=_e(),[_,M]=E([]),T=_.includes(A)||!!t,z=!h,{validate:I,error:w}=be(l,T,z),y=ge(),P=ye(l),N=U(P),[f,X]=E(t&&t.vaultPhone||b||P||""),[k,Y]=E(t&&t?.vaultEmail||p||""),x=g((u,d)=>{n({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:u,phoneNumber:d.phone,email:d.email,source:"order_created",trigger:s&&r?"auto":"manual"}})},[n,s,r]),D=g(u=>{I(u,l)||C("violationError",{error:{message:"The specified phone number does not match the expected pattern",code:"remember_me_phone_error",field:"phone",origin:"client",type:"inline-validation"},timestamp:new Date})},[l,I,C]),$=g((u,d)=>{O(d),X(u);const v=y(u,d);i({optInPhone:v??u,optInEmail:""})},[i,y]),re=g(u=>{Y(u);const d=y(m,l);i({optInPhone:d??m,optInEmail:u})},[y,m,i,l]),se=g(u=>{M(u);const d=u.includes(A),v=t&&t.vaultPhone||b||P||f,q=t&&t.vaultEmail||k;X(v),Y(q);const ie=y(v,l);i(d?{optInPhone:ie??v,optInEmail:h?"":q}:!1),d&&v&&I(v,l),x(d?"click_remember_me_box":"unclick_remember_me_box",{phone:v,email:q})},[l,k,y,I,f,x,i,b,P,t,h]);return S(()=>{if(!_.includes(A)||!s)return;const u=!f||f==="",d=P||b||void 0;u&&d&&d!==N.current?($(d,l),D(d),N.current=d):u||(N.current=d)},[_,f,l,P,b,t,$,s,x,D]),S(()=>{M(c?[A]:[])},[c]),S(()=>{T&&f&&I(f,l)},[]),S(()=>{if(n({schemaId:"shopify_pay_user_optin_ui_impression/1.0",payload:{elementType:"remember_me_box",source:"order_created"}}),s&&r){const u=h?"":k;x("click_remember_me_box",{phone:f,email:k}),i({optInPhone:f,optInEmail:u})}},[s,n,x]),e(Ie,{name:"RememberMe",value:_,variant:"group",onChange:se,children:e(Pe,{id:A,details:e(V,{children:[e(Ve,{}),h?e(ze,{countryCode:l,validationError:w,value:f,onInput:$,onBlur:()=>D(f)}):e(Be,{value:k,onInput:re}),r?null:e(oe,{children:e(ve,{field:h?"phone":"email",link:null})})]}),children:e(we,{})})})}function we(){const n=R(),o=Ee(),{autoOptIn:a}=G();return a?e(B,{children:n("shop_pay_remember_me.label_shop_account","Save my information for a faster checkout with a Shop account")}):o?e(B,{children:n("shop_pay_remember_me.payment_information_only_label","Save my payment information for a faster checkout")}):e(B,{children:n("shop_pay_remember_me.label","Save my information for a faster checkout")})}const De={title:"Shop",style:{fill:"var(--x-default-color-icon)",width:44,height:17}};function $e(){const o=R()("shop_pay_remember_me.secure_label","Secure and encrypted");return e(Q,{columns:["fill","auto"],children:[e(Q,{columns:["auto","fill"],spacing:"small400",blockAlignment:"center",children:[e(Se,{size:"extraSmall",source:"lock"}),e(Ce,{color:"subdued",type:"small",children:o})]}),e(Me,{children:e(Re,{...De})})]})}function Ue({variant:n}){const o=R(),a=Te(),[s,r]=W();if(S(()=>{!a&&s&&r(!1)},[a,r,s]),!a)return null;if(n==="minimal")return e(oe,{children:[e(L,{spacing:"small100"}),e(ne,{})]});const t=e(Oe,{sectionId:"rememberMe",children:e(ne,{})});return n==="compact"?e(Fe,{accessibilityLabel:o("shop_pay_remember_me.title","Remember me"),children:e(V,{children:[e(ee,{level:2,children:o("shop_pay_remember_me.title","Remember me")}),t]})}):e(V,{spacing:"none",children:[e(L,{spacing:"small100"}),e(ee,{level:2,children:o("shop_pay_remember_me.title","Remember me")}),e(L,{}),t,e(L,{spacing:"small100"}),e($e,{})]})}function We({localizationExtension:n,index:o}){const a=Ne(),{negotiate:s}=ke(),[r,t]=E(),[i,c]=E(),m=ae(n.fields.value,a),p=n.fields.title.value,{localizedFieldErrors:h}=xe(),b=`$.cart.localizedField.${n.peek().key}`,F=`$.localizationExtension[${o}]`,l=h.find(({target:_})=>_===b),O=_=>{const M=_.violations?.find(I=>{const{code:w,localizedMessage:y,nonLocalizedMessage:P,target:N}=I,f=y??P;if(w==="LOCALIZATION_EXTENSION_FIELD_ERROR"&&N===F)return f});if(!M)return;const{localizedMessage:T,nonLocalizedMessage:z}=M;return T??z};S(()=>{if(l){a.value=l.message;return}if(i){a.value=i;return}a.value=void 0},[a,l,i,r]);const C=()=>{m.onBlur(),t(void 0),c(void 0),s({fieldsToResolve:["localizationExtensions"],include:["localizationExtensions"],onComplete:_=>{c(O(_)),t("blur")}})};return Ae(_=>{c(O(_)),t("submit")}),e(H,{...m,label:p,name:p,onBlur:C,value:m.value??void 0})}export{We as L,Ue as R,Ge as u};
