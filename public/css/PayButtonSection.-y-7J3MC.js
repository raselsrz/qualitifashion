import{i as m,aS as d,aT as A,a as t,ar as g,aU as E,aV as P,aW as h,aX as N,D as C,aY as S,B as v,al as R,R as B,aZ as f,a_ as w,a$ as I,A as O,b0 as D,ae as V,b1 as M,b2 as U,af as b,b3 as L,b4 as k,ak as Y}from"./app.DCvXxO1S.js";import{S as x}from"./ShopPayOptInDisclaimer.Cv2rT4II.js";function $(){const e=m(),{value:n}=d(),u=A()||n?.amount===0?e("review.review_and_confirm_title","Review and confirm"):e("review.review_title","Review and pay");return t(g,{level:1,autoFocus:!0,children:u})}const W=e=>t(Y,{children:e});function j(){const e=E("Checkout::Actions::RenderBefore"),n=P(),{PayButton:a}=h();return t(f,{target:"cart.paymentLines[0]",children:t(N,{impressionType:"pay_now_button",impressionFeatures:[],children:[e.length!==0&&t(C,{children:[t(S,{extensions:e,render:W}),t(v,{spacing:"base"})]}),t(R,{ref:n,children:[t(q,{}),t(B,{children:t(a,{})}),t(x,{})]})]})})}const X=new Map([["PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT",{status:"warning",priority:-1,negotiationStage:"completion"}],["TAX_NEW_TAX_MUST_BE_ACCEPTED",{status:"warning",priority:-2,negotiationStage:"completion"}]]);function q(){const e=w(),n=F(e.value,X);return t(f,{target:"cart.paymentLines[0]",children:n.map(a=>t(I,{notice:a,errorType:O.PaymentError},a.code))})}function F(e,n){const a=D(),[u,p]=V([]),l=M(({violations:o,negotiationStage:y})=>{const r=[],T=o.some(i=>U.has(i.code));for(const i of o)if(!G(i)&&!(T&&(i.code==="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT"||i.code==="TAX_NEW_TAX_MUST_BE_ACCEPTED"))&&n.has(i.code)){if(T)continue;const c=n.get(i.code);y&&y===c?.negotiationStage&&r.push({...i,tone:c?.tone,priority:c?.priority})}if(r.length>=1){const c=r.map(s=>s.priority??0).reduce((s,_)=>s>_?s:_);return r.filter(s=>(s.priority??0)>=c)}return r},[n]);return b(()=>{e&&p(l({violations:e}))},[l]),L(o=>{o.type==="complete"||o.type==="invalid"||o.type==="failed"||!a.current||p(l({violations:o.violations,negotiationStage:o.negotiationStage}))}),u.filter(k("localizedMessage"))}function G(e){return e.__typename!=="ConfirmChangeViolation"&&e.__typename!=="UnprocessableTermViolation"&&e.__typename!=="RemoveTermViolation"}export{j as P,$ as R};
